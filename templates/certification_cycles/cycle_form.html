{% extends "layouts/base.html" %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block extrajs %}
<script src="{% static 'plugins/select2/js/select2.full.min.js' %}"></script>
<script>
  $(document).ready(function() {
    // Initialize Select2 Elements
    $('.select2').select2({
      theme: 'bootstrap4'
    });
    
    // Date picker initialization
    $('.datepicker').datetimepicker({
      format: 'DD.MM.YYYY',
      icons: {
        time: 'far fa-clock',
        date: 'far fa-calendar-alt',
        up: 'fas fa-arrow-up',
        down: 'fas fa-arrow-down',
        previous: 'fas fa-chevron-left',
        next: 'fas fa-chevron-right',
        today: 'far fa-calendar-check',
        clear: 'far fa-trash-alt',
        close: 'fas fa-times'
      }
    });

    // Stara logika za prikazivanje/sakrivanje polja za recertifikaciju je uklonjena
    // kako bi polja za audit dane bila uvek vidljiva
    const cycleTypeSelect = $('#id_cycle_type');
    
    // Bind change event to handle other functionality if needed
    cycleTypeSelect.on('change', function() {
      // Ovde možemo dodati drugu funkcionalnost po potrebi
    });

  });
</script>
{% endblock %}

{% block content %}
<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">
<section class="content-header">
  <div class="container-fluid">
    <div class="row mb-2">
      <div class="col-sm-6">
        <h1>{{ title }}</h1>
      </div>
      <div class="col-sm-6">
        <ol class="breadcrumb float-sm-right">
          <li class="breadcrumb-item"><a href="{% url 'company:dashboard' %}">Početna</a></li>
          {% if company %}
          <li class="breadcrumb-item"><a href="{% url 'company:detail' company.id %}">{{ company.name }}</a></li>
          {% endif %}
          <li class="breadcrumb-item"><a href="{% url 'company:cycle_list' %}">Ciklusi Sertifikacije</a></li>
          <li class="breadcrumb-item active">{{ title }}</li>
        </ol>
      </div>
    </div>
  </div>
</section>

<section class="content">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-12">
        <div class="card card-primary">
          <div class="card-header">
            <h3 class="card-title">{{ title }}</h3>
          </div>
          
          <form method="post">
            {% csrf_token %}
            <div class="card-body">
              {% if form.non_field_errors %}
              <div class="alert alert-danger">
                {% for error in form.non_field_errors %}
                {{ error }}
                {% endfor %}
              </div>
              {% endif %}
              
              <div class="row">
                <div class="col-md-6">
                  <div class="form-group">
                    {% if company %}
                      <label>Kompanija</label>
                      <input type="text" class="form-control" value="{{ company.name }}" readonly>
                      <input type="hidden" name="{{ form.company.name }}" value="{{ company.id }}">
                    {% else %}
                      <label for="{{ form.company.id_for_label }}">Kompanija</label>
                      {{ form.company }}
                    {% endif %}
                    {% if form.company.errors %}
                    <div class="invalid-feedback d-block">
                      {{ form.company.errors }}
                    </div>
                    {% endif %}
                  </div>
                </div>
                
                <div class="col-md-6">
                  <div class="form-group">
                    <label for="{{ form.status.id_for_label }}">Status</label>
                    {{ form.status }}
                    {% if form.status.errors %}
                    <div class="invalid-feedback d-block">
                      {{ form.status.errors }}
                    </div>
                    {% endif %}
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-md-6">
                  <div class="form-group">
                    <label for="{{ form.cycle_type.id_for_label }}">{{ form.cycle_type.label }}</label>
                    {{ form.cycle_type }}
                    {% if form.cycle_type.errors %}
                    <div class="invalid-feedback d-block">
                      {{ form.cycle_type.errors }}
                    </div>
                    {% endif %}
                  </div>
                </div>
              </div>

              <!-- Polja za broj dana audita su sada uvek vidljiva, nezavisno od tipa ciklusa -->
              <div class="row">
                <div class="col-12">
                  <h5 class="mt-4 mb-3">Dani audita</h5>
                </div>
              </div>
              <div class="row">
                <div class="col-md-4">
                  <div class="form-group">
                    <label for="{{ form.inicijalni_broj_dana.id_for_label }}">{{ form.inicijalni_broj_dana.label }}</label>
                    {{ form.inicijalni_broj_dana }}
                    {% if form.inicijalni_broj_dana.errors %}
                    <div class="invalid-feedback d-block">
                      {{ form.inicijalni_broj_dana.errors }}
                    </div>
                    {% endif %}
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group">
                    <label for="{{ form.broj_dana_nadzora.id_for_label }}">{{ form.broj_dana_nadzora.label }}</label>
                    {{ form.broj_dana_nadzora }}
                    {% if form.broj_dana_nadzora.errors %}
                    <div class="invalid-feedback d-block">
                      {{ form.broj_dana_nadzora.errors }}
                    </div>
                    {% endif %}
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group">
                    <label for="{{ form.broj_dana_resertifikacije.id_for_label }}">{{ form.broj_dana_resertifikacije.label }}</label>
                    {{ form.broj_dana_resertifikacije }}
                    {% if form.broj_dana_resertifikacije.errors %}
                    <div class="invalid-feedback d-block">
                      {{ form.broj_dana_resertifikacije.errors }}
                    </div>
                    {% endif %}
                  </div>
                </div>
              </div>
              
              <div class="row">
                <div class="col-md-6">
                  <div class="form-group">
                    <label for="{{ form.initial_audit_date.id_for_label }}">Datum inicijalnog audita</label>
                    <div class="input-group date" id="initial_audit_date_picker" data-target-input="nearest">
                      {{ form.initial_audit_date }}
                      <div class="input-group-append" data-target="#initial_audit_date_picker" data-toggle="datetimepicker">
                        <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                      </div>
                    </div>
                    {% if form.initial_audit_date.errors %}
                    <div class="invalid-feedback d-block">
                      {{ form.initial_audit_date.errors }}
                    </div>
                    {% endif %}
                    <small class="form-text text-muted">Ovaj datum će biti postavljen kao datum početka ciklusa.</small>
                  </div>
                </div>
              </div>
              
              <div class="row">
                <div class="col-md-6">
                  <div class="form-group">
                    <label for="{{ form.datum_sprovodjenja_inicijalne.id_for_label }}">Datum sprovođenja inicijalne</label>
                    <div class="input-group date" id="datum_sprovodjenja_inicijalne_picker" data-target-input="nearest">
                      {{ form.datum_sprovodjenja_inicijalne }}
                      <div class="input-group-append" data-target="#datum_sprovodjenja_inicijalne_picker" data-toggle="datetimepicker">
                        <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                      </div>
                    </div>
                    {% if form.datum_sprovodjenja_inicijalne.errors %}
                    <div class="invalid-feedback d-block">
                      {{ form.datum_sprovodjenja_inicijalne.errors }}
                    </div>
                    {% endif %}
                    <small class="form-text text-muted">Datum kada je sprovedena inicijalna provera za ciklus.</small>
                  </div>
                </div>
              </div>
              
              <div class="row">
                <div class="col-md-12">
                  <div class="form-group">
                    <label for="{{ form.standards.id_for_label }}">Standardi</label>
                    {{ form.standards }}
                    {% if form.standards.errors %}
                    <div class="invalid-feedback d-block">
                      {{ form.standards.errors }}
                    </div>
                    {% endif %}
                    <small class="form-text text-muted">Izaberite standarde koji su uključeni u ovaj ciklus sertifikacije.</small>
                  </div>
                </div>
              </div>
              
              <div class="row">
                <div class="col-md-6">
                  <div class="form-group">
                    <label for="{{ form.lead_auditor.id_for_label }}">Vodeći auditor inicijalnog audita</label>
                    {{ form.lead_auditor }}
                    {% if form.lead_auditor.errors %}
                    <div class="invalid-feedback d-block">
                      {{ form.lead_auditor.errors }}
                    </div>
                    {% endif %}
                  </div>
                </div>
                
                <div class="col-md-6">
                  <div class="form-group">
                    <label for="{{ form.report_number.id_for_label }}">Broj izveštaja inicijalnog audita</label>
                    {{ form.report_number }}
                    {% if form.report_number.errors %}
                    <div class="invalid-feedback d-block">
                      {{ form.report_number.errors }}
                    </div>
                    {% endif %}
                  </div>
                </div>
              </div>
              

              
              <div class="row">
                <div class="col-md-12">
                  <div class="form-group">
                    <div class="custom-control custom-checkbox">
                      {{ form.is_integrated_system }}
                      <label class="custom-control-label" for="{{ form.is_integrated_system.id_for_label }}">
                        Integrisani sistem
                      </label>
                    </div>
                    {% if form.is_integrated_system.errors %}
                    <div class="invalid-feedback d-block">
                      {{ form.is_integrated_system.errors }}
                    </div>
                    {% endif %}
                  </div>
                </div>
              </div>
              
              <div class="row">
                <div class="col-md-12">
                  <div class="form-group">
                    <label for="{{ form.notes.id_for_label }}">Napomene</label>
                    {{ form.notes }}
                    {% if form.notes.errors %}
                    <div class="invalid-feedback d-block">
                      {{ form.notes.errors }}
                    </div>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
            
            <div class="card-footer">
              <button type="submit" class="btn btn-primary">Sačuvaj</button>
              {% if company %}
              <a href="{% url 'company:detail' company.id %}" class="btn btn-secondary">Odustani</a>
              {% else %}
              <a href="{% url 'company:cycle_list' %}" class="btn btn-secondary">Odustani</a>
              {% endif %}
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</section>
</div>
<!-- /.content-wrapper -->
{% endblock %}
