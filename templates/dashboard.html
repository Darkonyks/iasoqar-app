{% extends "layouts/base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h1>Dashboard</h1>
                </div>
            </div>
        </div><!-- /.container-fluid -->
    </section>

    <!-- Main content -->
    <section class="content">
        <div class="container-fluid">
            <!-- Tabovi za organizaciju sadržaja -->
            <div class="card card-primary card-outline card-tabs">
                <div class="card-header p-0 pt-1 border-bottom-0">
                    <ul class="nav nav-tabs" id="dashboard-tabs" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" id="overview-tab" data-toggle="pill" href="#overview" role="tab" aria-controls="overview" aria-selected="true">
                                <i class="fas fa-tachometer-alt"></i> Pregled
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="companies-tab" data-toggle="pill" href="#companies" role="tab" aria-controls="companies" aria-selected="false">
                                <i class="fas fa-building"></i> Kompanije
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="audits-tab" data-toggle="pill" href="#audits" role="tab" aria-controls="audits" aria-selected="false">
                                <i class="fas fa-clipboard-check"></i> Auditi
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="srbija-tim-tab" data-toggle="pill" href="#srbija-tim" role="tab" aria-controls="srbija-tim" aria-selected="false">
                                <i class="fas fa-users"></i> Srbija Tim
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="card-body">
                    <div class="tab-content" id="dashboard-tabContent">
                        <!-- Tab 1: Pregled -->
                        <div class="tab-pane fade show active" id="overview" role="tabpanel" aria-labelledby="overview-tab">
                            <h4 class="mb-3"><i class="fas fa-chart-pie"></i> Brzi Pregled</h4>
                            
                            <!-- Red 1: Kompanije i Auditi -->
                            <div class="row">
                                <div class="col-lg-3 col-md-6">
                                    <div class="small-box bg-info">
                                        <div class="inner">
                                            <h3>{{ total_companies }}</h3>
                                            <p>Ukupno Kompanija</p>
                                        </div>
                                        <div class="icon"><i class="fas fa-building"></i></div>
                                        <a href="#companies" data-toggle="pill" class="small-box-footer">Detalji <i class="fas fa-arrow-circle-right"></i></a>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6">
                                    <div class="small-box bg-success">
                                        <div class="inner">
                                            <h3>{{ active_companies }}</h3>
                                            <p>Aktivni Sertifikati</p>
                                        </div>
                                        <div class="icon"><i class="fas fa-check-circle"></i></div>
                                        <a href="#companies" data-toggle="pill" class="small-box-footer">Detalji <i class="fas fa-arrow-circle-right"></i></a>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6">
                                    <div class="small-box bg-warning">
                                        <div class="inner">
                                            <h3>{{ upcoming_audits_30_days_count }}</h3>
                                            <p>Auditi (30 Dana)</p>
                                        </div>
                                        <div class="icon"><i class="fas fa-calendar-alt"></i></div>
                                        <a href="#audits" data-toggle="pill" class="small-box-footer">Detalji <i class="fas fa-arrow-circle-right"></i></a>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6">
                                    <div class="small-box bg-danger">
                                        <div class="inner">
                                            <h3>{{ srbija_tim_reports_pending }}</h3>
                                            <p>Neposlati Izveštaji</p>
                                        </div>
                                        <div class="icon"><i class="fas fa-exclamation-triangle"></i></div>
                                        <a href="#srbija-tim" data-toggle="pill" class="small-box-footer">Detalji <i class="fas fa-arrow-circle-right"></i></a>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Red 2: Sertifikati i Auditori -->
                            <div class="row mt-3">
                                <div class="col-lg-3 col-md-6">
                                    <div class="small-box" style="background-color: #dc3545; color: white;">
                                        <div class="inner">
                                            <h3>{{ expiring_30_days }}</h3>
                                            <p>Sertifikati Ističu (30d)</p>
                                        </div>
                                        <div class="icon"><i class="fas fa-exclamation-circle"></i></div>
                                        <a href="#companies" data-toggle="pill" class="small-box-footer" style="color: rgba(255,255,255,0.8);">Detalji <i class="fas fa-arrow-circle-right"></i></a>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6">
                                    <div class="small-box bg-purple">
                                        <div class="inner">
                                            <h3>{{ total_auditors }}</h3>
                                            <p>Ukupno Auditora</p>
                                        </div>
                                        <div class="icon"><i class="fas fa-user-tie"></i></div>
                                        <a href="{% url 'company:auditor_list' %}" class="small-box-footer">Detalji <i class="fas fa-arrow-circle-right"></i></a>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6">
                                    <div class="small-box bg-teal">
                                        <div class="inner">
                                            <h3>{{ active_cycles }}</h3>
                                            <p>Aktivni Ciklusi</p>
                                        </div>
                                        <div class="icon"><i class="fas fa-sync-alt"></i></div>
                                        <a href="{% url 'company:cycle_list' %}" class="small-box-footer">Detalji <i class="fas fa-arrow-circle-right"></i></a>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6">
                                    <div class="small-box bg-gradient-orange">
                                        <div class="inner">
                                            <h3>{{ integrated_systems }}</h3>
                                            <p>Integrisani Sistemi</p>
                                        </div>
                                        <div class="icon"><i class="fas fa-layer-group"></i></div>
                                        <a href="{% url 'company:cycle_list' %}" class="small-box-footer">Detalji <i class="fas fa-arrow-circle-right"></i></a>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Tabela sertifikata koji ističu -->
                            {% if expiring_certificates_list %}
                            <div class="row mt-4">
                                <div class="col-12">
                                    <div class="card card-danger">
                                        <div class="card-header">
                                            <h3 class="card-title"><i class="fas fa-exclamation-triangle"></i> Sertifikati koji Ističu (Narednih 30 Dana)</h3>
                                        </div>
                                        <div class="card-body p-0">
                                            <div class="table-responsive">
                                                <table class="table table-striped table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Kompanija</th>
                                                            <th>Standard</th>
                                                            <th>Broj Sertifikata</th>
                                                            <th>Datum Isticanja</th>
                                                            <th>Broj Dana</th>
                                                            <th>Akcija</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for cert in expiring_certificates_list %}
                                                        {% with days_left=cert.certificate_expiry_date|timeuntil %}
                                                        <tr>
                                                            <td><strong>{{ cert.company.name }}</strong></td>
                                                            <td><span class="badge badge-info">{{ cert.standard_definition.code }}</span></td>
                                                            <td>{{ cert.certificate_number }}</td>
                                                            <td>
                                                                <i class="fas fa-calendar"></i> {{ cert.certificate_expiry_date|date:"d.m.Y" }}
                                                            </td>
                                                            <td>
                                                                {% with cert.certificate_expiry_date|timeuntil as days_until %}
                                                                {% if cert.certificate_expiry_date < today %}
                                                                <span class="badge badge-danger">Istekao</span>
                                                                {% else %}
                                                                {{ days_until }}
                                                                {% endif %}
                                                                {% endwith %}
                                                            </td>
                                                            <td>
                                                                <a href="{% url 'company:detail' cert.company.pk %}" class="btn btn-sm btn-info" title="Detalji kompanije">
                                                                    <i class="fas fa-eye"></i>
                                                                </a>
                                                            </td>
                                                        </tr>
                                                        {% endwith %}
                                                        {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                        
                        <!-- Tab 2: Kompanije -->
                        <div class="tab-pane fade" id="companies" role="tabpanel" aria-labelledby="companies-tab">
                            <h4 class="mb-3"><i class="fas fa-building"></i> Kompanije - Statistika</h4>
            
            <div class="row">
                <!-- Ukupan broj kompanija -->
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="small-box bg-info">
                        <div class="inner">
                            <h3>{{ total_companies }}</h3>
                            <p>Ukupan Broj Kompanija</p>
                        </div>
                        <div class="icon">
                            <i class="fas fa-building"></i>
                        </div>
                        <a href="{% url 'company:list' %}" class="small-box-footer">
                            Više informacija <i class="fas fa-arrow-circle-right"></i>
                        </a>
                    </div>
                </div>
                
                <!-- Aktivni sertifikati -->
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="small-box" style="background-color: #28a745; color: white;">
                        <div class="inner">
                            <h3>{{ active_companies }}</h3>
                            <p>Aktivni Sertifikati</p>
                        </div>
                        <div class="icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <a href="{% url 'company:list' %}?certificate_status=active" class="small-box-footer" style="color: rgba(255,255,255,0.8);">
                            Više informacija <i class="fas fa-arrow-circle-right"></i>
                        </a>
                    </div>
                </div>
                
                <!-- Suspendovani -->
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="small-box" style="background-color: #ffc107; color: white;">
                        <div class="inner">
                            <h3>{{ suspended_companies }}</h3>
                            <p>Suspendovani</p>
                        </div>
                        <div class="icon">
                            <i class="fas fa-pause-circle"></i>
                        </div>
                        <a href="{% url 'company:list' %}?certificate_status=suspended" class="small-box-footer" style="color: rgba(255,255,255,0.8);">
                            Više informacija <i class="fas fa-arrow-circle-right"></i>
                        </a>
                    </div>
                </div>
                
                <!-- Istekli -->
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="small-box" style="background-color: #dc3545; color: white;">
                        <div class="inner">
                            <h3>{{ expired_companies }}</h3>
                            <p>Istekli</p>
                        </div>
                        <div class="icon">
                            <i class="fas fa-times-circle"></i>
                        </div>
                        <a href="{% url 'company:list' %}?certificate_status=expired" class="small-box-footer" style="color: rgba(255,255,255,0.8);">
                            Više informacija <i class="fas fa-arrow-circle-right"></i>
                        </a>
                    </div>
                </div>
                
                <!-- Na čekanju -->
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="small-box" style="background-color: #007bff; color: white;">
                        <div class="inner">
                            <h3>{{ pending_companies }}</h3>
                            <p>Na Čekanju</p>
                        </div>
                        <div class="icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <a href="{% url 'company:list' %}?certificate_status=pending" class="small-box-footer" style="color: rgba(255,255,255,0.8);">
                            Više informacija <i class="fas fa-arrow-circle-right"></i>
                        </a>
                    </div>
                </div>
                
                <!-- Deregistrovani -->
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="small-box bg-secondary">
                        <div class="inner">
                            <h3>{{ withdrawn_companies }}</h3>
                            <p>Deregistrovani</p>
                        </div>
                        <div class="icon">
                            <i class="fas fa-ban"></i>
                        </div>
                        <a href="{% url 'company:list' %}?certificate_status=withdrawn" class="small-box-footer">
                            Više informacija <i class="fas fa-arrow-circle-right"></i>
                        </a>
                    </div>
                </div>
                
                <!-- Otkazani -->
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="small-box bg-dark">
                        <div class="inner">
                            <h3>{{ cancelled_companies }}</h3>
                            <p>Otkazani</p>
                        </div>
                        <div class="icon">
                            <i class="fas fa-minus-circle"></i>
                        </div>
                        <a href="{% url 'company:list' %}?certificate_status=cancelled" class="small-box-footer">
                            Više informacija <i class="fas fa-arrow-circle-right"></i>
                        </a>
                    </div>
                </div>
                
                <!-- Aktivni sertifikati (standardi) -->
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="small-box bg-teal">
                        <div class="inner">
                            <h3>{{ active_certificates }}</h3>
                            <p>Aktivni Standardi</p>
                        </div>
                        <div class="icon">
                            <i class="fas fa-certificate"></i>
                        </div>
                        <a href="{% url 'company:list' %}" class="small-box-footer">
                            Više informacija <i class="fas fa-arrow-circle-right"></i>
                        </a>
                    </div>
                </div>
            </div>
            <!-- /.row -->
            
            <!-- Sertifikati - Isticanje -->
            <div class="row mt-4 mb-3">
                <div class="col-12">
                    <h5 class="mb-3"><i class="fas fa-certificate"></i> Sertifikati - Isticanje</h5>
                </div>
            </div>
            
            <div class="row">
                <div class="col-lg-3 col-md-6">
                    <div class="info-box bg-danger">
                        <span class="info-box-icon"><i class="fas fa-exclamation-triangle"></i></span>
                        <div class="info-box-content">
                            <span class="info-box-text">Ističu (30 Dana)</span>
                            <span class="info-box-number">{{ expiring_30_days }}</span>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="info-box bg-warning">
                        <span class="info-box-icon"><i class="fas fa-clock"></i></span>
                        <div class="info-box-content">
                            <span class="info-box-text">Ističu (60 Dana)</span>
                            <span class="info-box-number">{{ expiring_60_days }}</span>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="info-box bg-info">
                        <span class="info-box-icon"><i class="fas fa-calendar-alt"></i></span>
                        <div class="info-box-content">
                            <span class="info-box-text">Ističu (90 Dana)</span>
                            <span class="info-box-number">{{ expiring_90_days }}</span>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="info-box bg-secondary">
                        <span class="info-box-icon"><i class="fas fa-times-circle"></i></span>
                        <div class="info-box-content">
                            <span class="info-box-text">Već Istekli</span>
                            <span class="info-box-number">{{ expired_certificates_count }}</span>
                        </div>
                    </div>
                </div>
            </div>
                        </div>
                        <!-- End Tab 2: Kompanije -->
                        
                        <!-- Tab 3: Auditi -->
                        <div class="tab-pane fade" id="audits" role="tabpanel" aria-labelledby="audits-tab">
                            <h4 class="mb-3"><i class="fas fa-clipboard-check"></i> Auditi - Pregled Statusa</h4>
            
            <div class="row">
                <!-- Planirani auditi -->
                <div class="col-lg-3 col-md-6 col-sm-6">
                    <div class="small-box bg-info">
                        <div class="inner">
                            <h3>{{ planned_audits_count }}</h3>
                            <p>Planirani Auditi</p>
                        </div>
                        <div class="icon">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <a href="{% url 'company:calendar' %}" class="small-box-footer">
                            Više informacija <i class="fas fa-arrow-circle-right"></i>
                        </a>
                    </div>
                </div>
                
                <!-- Zakazani auditi -->
                <div class="col-lg-3 col-md-6 col-sm-6">
                    <div class="small-box" style="background-color: #17a2b8; color: white;">
                        <div class="inner">
                            <h3>{{ scheduled_audits_count }}</h3>
                            <p>Zakazani Auditi</p>
                        </div>
                        <div class="icon">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <a href="{% url 'company:calendar' %}" class="small-box-footer" style="color: rgba(255,255,255,0.8);">
                            Više informacija <i class="fas fa-arrow-circle-right"></i>
                        </a>
                    </div>
                </div>
                
                <!-- Završeni auditi (ovaj mesec) -->
                <div class="col-lg-3 col-md-6 col-sm-6">
                    <div class="small-box bg-success">
                        <div class="inner">
                            <h3>{{ completed_audits_this_month }}</h3>
                            <p>Završeni (Ovaj Mesec)</p>
                        </div>
                        <div class="icon">
                            <i class="fas fa-check-double"></i>
                        </div>
                        <a href="{% url 'company:calendar' %}" class="small-box-footer">
                            Više informacija <i class="fas fa-arrow-circle-right"></i>
                        </a>
                    </div>
                </div>
                
                <!-- Odloženi auditi -->
                <div class="col-lg-3 col-md-6 col-sm-6">
                    <div class="small-box bg-warning">
                        <div class="inner">
                            <h3>{{ postponed_audits_count }}</h3>
                            <p>Odloženi Auditi</p>
                        </div>
                        <div class="icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <a href="{% url 'company:calendar' %}" class="small-box-footer">
                            Više informacija <i class="fas fa-arrow-circle-right"></i>
                        </a>
                    </div>
                </div>
            </div>
            <!-- /.row -->
            
            <!-- Dodatne metrike za audite -->
            <div class="row mt-3">
                <!-- Auditi u narednih 30 dana -->
                <div class="col-lg-6 col-md-6">
                    <div class="info-box bg-gradient-info">
                        <span class="info-box-icon"><i class="fas fa-calendar-week"></i></span>
                        <div class="info-box-content">
                            <span class="info-box-text">Auditi u Narednih 30 Dana</span>
                            <span class="info-box-number">{{ upcoming_audits_30_days_count }}</span>
                            <div class="progress">
                                <div class="progress-bar" style="width: 100%"></div>
                            </div>
                            <span class="progress-description">
                                <a href="#upcoming-audits-table" class="text-white" style="text-decoration: underline;">Pogledaj listu</a>
                            </span>
                        </div>
                    </div>
                </div>
                
                <!-- Prosečan broj dana po auditu -->
                <div class="col-lg-6 col-md-6">
                    <div class="info-box bg-gradient-success">
                        <span class="info-box-icon"><i class="fas fa-chart-line"></i></span>
                        <div class="info-box-content">
                            <span class="info-box-text">Prosečan Broj Dana po Auditu</span>
                            <span class="info-box-number">{{ average_audit_days }} dana</span>
                            <div class="progress">
                                <div class="progress-bar" style="width: 100%"></div>
                            </div>
                            <span class="progress-description">
                                Izračunato iz aktivnih ciklusa
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /.row -->
            
            <!-- Tabela predstojećih audita -->
            {% if upcoming_audits_30_days %}
            <div class="row mt-3" id="upcoming-audits-table">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title"><i class="fas fa-list"></i> Predstojeći Auditi (Narednih 30 Dana)</h3>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>Kompanija</th>
                                            <th>Tip Audita</th>
                                            <th>Planirani Datum</th>
                                            <th>Vodeći Auditor</th>
                                            <th>Status</th>
                                            <th>Akcije</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for audit in upcoming_audits_30_days %}
                                        <tr>
                                            <td><strong>{{ audit.certification_cycle.company.name }}</strong></td>
                                            <td>
                                                <span class="badge badge-info">{{ audit.get_audit_type_display }}</span>
                                            </td>
                                            <td>
                                                <i class="fas fa-calendar"></i> {{ audit.planned_date|date:"d.m.Y" }}
                                                {% if audit.planned_date == today %}
                                                <span class="badge badge-danger">Danas</span>
                                                {% elif audit.planned_date <= seven_days_from_now %}
                                                <span class="badge badge-warning">Uskoro</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                {% if audit.lead_auditor %}
                                                <i class="fas fa-user"></i> {{ audit.lead_auditor.ime_prezime }}
                                                {% else %}
                                                <span class="text-muted">Nije dodeljen</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                {% if audit.audit_status == 'planned' %}
                                                <span class="badge badge-primary">{{ audit.get_audit_status_display }}</span>
                                                {% elif audit.audit_status == 'scheduled' %}
                                                <span class="badge badge-info">{{ audit.get_audit_status_display }}</span>
                                                {% elif audit.audit_status == 'completed' %}
                                                <span class="badge badge-success">{{ audit.get_audit_status_display }}</span>
                                                {% elif audit.audit_status == 'postponed' %}
                                                <span class="badge badge-warning">{{ audit.get_audit_status_display }}</span>
                                                {% else %}
                                                <span class="badge badge-secondary">{{ audit.get_audit_status_display }}</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                <a href="{% url 'company:cycle_audit_update' audit.pk %}" class="btn btn-sm btn-primary" title="Izmeni">
                                                    <i class="fas fa-edit"></i>
                                                </a>
                                                <a href="{% url 'company:cycle_detail' audit.certification_cycle.pk %}" class="btn btn-sm btn-info" title="Detalji ciklusa">
                                                    <i class="fas fa-eye"></i>
                                                </a>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
            <!-- /.row -->
                        </div>
                        <!-- End Tab 3: Auditi -->
                        
                        <!-- Tab 4: Srbija Tim -->
                        <div class="tab-pane fade" id="srbija-tim" role="tabpanel" aria-labelledby="srbija-tim-tab">
                            <h4 class="mb-3"><i class="fas fa-users"></i> Srbija Tim - Crni Kalendar</h4>
                            
                            <div class="row">
                                <!-- Zakazane posete (ovaj mesec) -->
                                <div class="col-lg-3 col-md-6">
                                    <div class="small-box bg-info">
                                        <div class="inner">
                                            <h3>{{ srbija_tim_scheduled_this_month }}</h3>
                                            <p>Zakazane (Ovaj Mesec)</p>
                                        </div>
                                        <div class="icon"><i class="fas fa-calendar-check"></i></div>
                                        <a href="{% url 'company:srbija_tim_calendar' %}" class="small-box-footer">
                                            Više informacija <i class="fas fa-arrow-circle-right"></i>
                                        </a>
                                    </div>
                                </div>
                                
                                <!-- Odrađene posete (ovaj mesec) -->
                                <div class="col-lg-3 col-md-6">
                                    <div class="small-box bg-success">
                                        <div class="inner">
                                            <h3>{{ srbija_tim_completed_this_month }}</h3>
                                            <p>Odrađene (Ovaj Mesec)</p>
                                        </div>
                                        <div class="icon"><i class="fas fa-check-circle"></i></div>
                                        <a href="{% url 'company:srbija_tim_list' %}" class="small-box-footer">
                                            Više informacija <i class="fas fa-arrow-circle-right"></i>
                                        </a>
                                    </div>
                                </div>
                                
                                <!-- Poslati izveštaji -->
                                <div class="col-lg-3 col-md-6">
                                    <div class="small-box" style="background-color: #28a745; color: white;">
                                        <div class="inner">
                                            <h3>{{ srbija_tim_reports_sent }}</h3>
                                            <p>Poslati Izveštaji</p>
                                        </div>
                                        <div class="icon"><i class="fas fa-file-alt"></i></div>
                                        <a href="{% url 'company:srbija_tim_list' %}" class="small-box-footer" style="color: rgba(255,255,255,0.8);">
                                            Više informacija <i class="fas fa-arrow-circle-right"></i>
                                        </a>
                                    </div>
                                </div>
                                
                                <!-- Neposlati izveštaji -->
                                <div class="col-lg-3 col-md-6">
                                    <div class="small-box bg-danger">
                                        <div class="inner">
                                            <h3>{{ srbija_tim_reports_pending }}</h3>
                                            <p>Neposlati Izveštaji</p>
                                        </div>
                                        <div class="icon"><i class="fas fa-exclamation-triangle"></i></div>
                                        <a href="{% url 'company:srbija_tim_list' %}" class="small-box-footer">
                                            Više informacija <i class="fas fa-arrow-circle-right"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Posete u narednih 7 dana -->
                            {% if srbija_tim_upcoming_7_days %}
                            <div class="row mt-3">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header bg-gradient-info">
                                            <h3 class="card-title"><i class="fas fa-calendar-week"></i> Predstojeće Posete (Narednih 7 Dana)</h3>
                                        </div>
                                        <div class="card-body p-0">
                                            <div class="table-responsive">
                                                <table class="table table-striped table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Kompanija</th>
                                                            <th>Broj Sertifikata</th>
                                                            <th>Datum Posete</th>
                                                            <th>Auditori</th>
                                                            <th>Standardi</th>
                                                            <th>Status</th>
                                                            <th>Akcije</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for visit in srbija_tim_upcoming_7_days %}
                                                        <tr>
                                                            <td><strong>{{ visit.company.name }}</strong></td>
                                                            <td>{{ visit.certificate_number }}</td>
                                                            <td>
                                                                <i class="fas fa-calendar"></i> {{ visit.visit_date|date:"d.m.Y" }}
                                                                {% if visit.visit_time %}
                                                                <br><small><i class="fas fa-clock"></i> {{ visit.visit_time|time:"H:i" }}</small>
                                                                {% endif %}
                                                                {% if visit.visit_date == today %}
                                                                <span class="badge badge-danger">Danas</span>
                                                                {% endif %}
                                                            </td>
                                                            <td>
                                                                {% if visit.get_auditors_display %}
                                                                <i class="fas fa-user"></i> {{ visit.get_auditors_display }}
                                                                {% else %}
                                                                <span class="text-muted">Nije dodeljeno</span>
                                                                {% endif %}
                                                            </td>
                                                            <td>
                                                                {% if visit.get_standards_display %}
                                                                <span class="badge badge-info">{{ visit.get_standards_display }}</span>
                                                                {% else %}
                                                                <span class="text-muted">-</span>
                                                                {% endif %}
                                                            </td>
                                                            <td>
                                                                {% if visit.status == 'zakazan' %}
                                                                <span class="badge badge-primary">Zakazan</span>
                                                                {% elif visit.status == 'odradjena' %}
                                                                <span class="badge badge-success">Odrađena</span>
                                                                {% else %}
                                                                <span class="badge badge-secondary">Nije zakazan</span>
                                                                {% endif %}
                                                                {% if visit.report_sent %}
                                                                <br><span class="badge badge-success mt-1"><i class="fas fa-check"></i> Izveštaj poslat</span>
                                                                {% endif %}
                                                            </td>
                                                            <td>
                                                                <a href="{% url 'company:srbija_tim_update' visit.pk %}" class="btn btn-sm btn-primary" title="Izmeni">
                                                                    <i class="fas fa-edit"></i>
                                                                </a>
                                                                <a href="{% url 'company:srbija_tim_detail' visit.pk %}" class="btn btn-sm btn-info" title="Detalji">
                                                                    <i class="fas fa-eye"></i>
                                                                </a>
                                                            </td>
                                                        </tr>
                                                        {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                        <!-- End Tab 4: Srbija Tim -->
                    </div>
                    <!-- /.tab-content -->
                </div>
                <!-- /.card-body -->
            </div>
            <!-- /.card -->
            
            <!-- Separator -->
            <hr class="my-4">

            <!-- Main row -->
            <div class="row">
                <!-- Left col -->
                <section class="col-lg-7 connectedSortable">
                    <!-- Standards Distribution Chart -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Standards Distribution</h3>
                        </div>
                        <div class="card-body">
                            <canvas id="standardsChart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                        </div>
                    </div>
                    
                    <!-- This Week's Audits -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Auditi za tekuću radnu nedelju</h3>
                        </div>
                        <div class="card-body">
                            {% if this_week_audits %}
                                <div class="table-responsive">
                                    <table class="table table-bordered table-striped">
                                        <thead>
                                            <tr>
                                                <th>Kompanija</th>
                                                <th>Tip audita</th>
                                                <th>Datum</th>
                                                <th>Status</th>
                                                <th>Akcije</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for audit in this_week_audits %}
                                                <tr>
                                                    <td>{{ audit.company }}</td>
                                                    <td>{{ audit.type }}</td>
                                                    <td>{{ audit.date|date:"d.m.Y H:i" }}</td>
                                                    <td>{{ audit.status }}</td>
                                                    <td>
                                                        <a href="{% url 'company:audit_detail' audit.id %}" class="btn btn-sm btn-info">
                                                            <i class="fas fa-eye"></i> Detalji
                                                        </a>
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            {% else %}
                                <div class="alert alert-info">
                                    Nema zakazanih audita za tekuću radnu nedelju.
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </section>
                <!-- /.Left col -->

                <!-- Right col -->
                <section class="col-lg-5 connectedSortable">
                    <!-- Certificate Status Chart -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Certificate Status</h3>
                        </div>
                        <div class="card-body">
                            <canvas id="certificateChart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                        </div>
                    </div>
                </section>
                <!-- /.Right col -->
            </div>
            <!-- /.row -->
        </div><!-- /.container-fluid -->
    </section>
    <!-- /.content -->
</div>
<!-- /.content-wrapper -->

{% endblock %}

{% block extra_js %}
<!-- ChartJS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
// Standards Distribution Chart
var standardsCtx = document.getElementById('standardsChart').getContext('2d');
var standardsChart = new Chart(standardsCtx, {
    type: 'bar',
    data: {
        labels: JSON.parse('{{ standards_labels|safe }}'),
        datasets: [{
            label: 'Number of Companies',
            data: JSON.parse('{{ standards_data|safe }}'),
            backgroundColor: 'rgba(54, 162, 235, 0.2)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1
        }]
    },
    options: {
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});

// Certificate Status Chart
var certificateCtx = document.getElementById('certificateChart').getContext('2d');
var certificateChart = new Chart(certificateCtx, {
    type: 'pie',
    data: {
        labels: JSON.parse('{{ certificate_labels|safe }}'),
        datasets: [{
            data: JSON.parse('{{ certificate_data|safe }}'),
            backgroundColor: [
                'rgba(75, 192, 192, 0.2)',
                'rgba(255, 99, 132, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)',
                'rgba(199, 199, 199, 0.2)'
            ],
            borderColor: [
                'rgba(75, 192, 192, 1)',
                'rgba(255, 99, 132, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)',
                'rgba(199, 199, 199, 1)'
            ],
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                position: 'top',
            },
            title: {
                display: true,
                text: 'Certificate Status Distribution'
            }
        }
    }
});
</script>
{% endblock %}
