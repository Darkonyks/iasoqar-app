{% extends 'layouts/base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{{ title }}{% endblock %}

{% block extrastyle %}
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap4.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.4.0/css/responsive.bootstrap4.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.3.3/css/buttons.bootstrap4.min.css">
<style>
    .badge-category {
        font-size: 85%;
    }
    .badge-lead-auditor {
        background-color: #28a745;
    }
    .badge-auditor {
        background-color: #007bff;
    }
    .badge-technical-expert {
        background-color: #6c757d;
    }
    .badge-trainer {
        background-color: #17a2b8;
    }
    .action-buttons {
        white-space: nowrap;
    }
    .card {
        box-shadow: 0 4px 24px rgba(44, 62, 80, 0.12), 0 1.5px 4px rgba(44, 62, 80, 0.10);
        border-radius: 1rem;
        border: none;
        background: #f8f9fa;
    }
    .card-body {
        border-radius: 1rem;
    }
    .table {
        background: white;
        border-radius: 0.75rem;
        overflow: hidden;
        box-shadow: 0 1px 8px rgba(44,62,80,0.06);
    }
    .table thead th {
        background: #e9ecef;
        border: none;
        font-weight: 600;
        color: #495057;
    }
    .table-striped tbody tr:nth-of-type(odd) {
        background-color: #f4f8fb;
    }
    .btn {
        border-radius: 0.5rem;
        transition: background 0.2s, box-shadow 0.2s;
        box-shadow: 0 2px 6px rgba(44,62,80,0.07);
    }
    .btn-info {
        background: #4fd1c5;
        border: none;
        color: white;
    }
    .btn-info:hover {
        background: #38b2ac;
        color: white;
    }
    .btn-primary {
        background: #6366f1;
        border: none;
        color: white;
    }
    .btn-primary:hover {
        background: #4338ca;
        color: white;
    }
    .btn-danger {
        background: #ef4444;
        border: none;
        color: white;
    }
    .btn-danger:hover {
        background: #b91c1c;
        color: white;
    }
    .btn:focus {
        outline: none;
        box-shadow: 0 0 0 0.2rem rgba(99,102,241,0.15);
    }
    /* Hover effect for table rows */
    .table tbody tr:hover {
        background: #e0e7ff;
        transition: background 0.2s;
    }
</style>
{% endblock %}

{% block content %}
<div class="content-wrapper">
  <div class="content-header">
    <div class="container-fluid">
      <div class="row mb-2">
        <div class="col-sm-6">
          <h1 class="m-0">{{ title }}</h1>
        </div>
        <div class="col-sm-6">
          <div class="float-sm-right">
            <a href="{% url 'company:auditor_create' %}" class="btn btn-primary">
              <i class="fas fa-plus"></i> Novi auditor
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="content">
    <div class="container-fluid">
      <!-- Search form -->
      <div class="card mb-4">
        <div class="card-body">
          <div class="input-group w-100">
            <div class="input-group-prepend">
              <span class="input-group-text"><i class="fas fa-search"></i></span>
            </div>
            <input type="text" id="tableSearch" class="form-control" placeholder="Pretraži po imenu, email-u, telefonu, kategoriji, standardima ili IAF/EAC kodovima">
          </div>
        </div>
      </div>

      <div class="card shadow-lg border-0 rounded-4">
        <div class="card-body p-4 bg-light rounded-4">
          <table id="auditorsTable" class="table table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th>Ime i prezime</th>
                                    <th>Kategorija</th>
                                    <th>Email</th>
                                    <th>Telefon</th>
                                    <th>Standardi</th>
                                    <th>IAF/EAC codes</th>
                                    <th>Akcije</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for auditor in auditors %}
                                <tr>
                                    <td>{{ auditor.ime_prezime }}</td>
                                    <td>
                                        {% if auditor.kategorija == 'lead_auditor' %}
                                        <span class="badge badge-success badge-category badge-lead-auditor">Lead auditor</span>
                                        {% elif auditor.kategorija == 'auditor' %}
                                        <span class="badge badge-primary badge-category badge-auditor">Auditor</span>
                                        {% elif auditor.kategorija == 'technical_expert' %}
                                        <span class="badge badge-secondary badge-category badge-technical-expert">Tehnički ekspert</span>
                                        {% elif auditor.kategorija == 'trainer' %}
                                        <span class="badge badge-info badge-category badge-trainer">Trainer</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ auditor.email }}</td>
                                    <td>{{ auditor.telefon }}</td>
                                    <td>
                                        {% if auditor.auditor_standardi.all %}
                                        <ul class="list-unstyled mb-0">
                                            {% for standard in auditor.auditor_standardi.all %}
                                            <li class="mb-1">
                                                {% with standard_code=standard.standard.code %}
                                                {% if 'ISO9001' in standard_code %}
                                                    <span class="badge badge-primary p-2">{{ standard_code }}</span>
                                                {% elif 'ISO14001' in standard_code %}
                                                    <span class="badge badge-success p-2">{{ standard_code }}</span>
                                                {% elif 'ISO45001' in standard_code %}
                                                    <span class="badge badge-danger p-2">{{ standard_code }}</span>
                                                {% elif 'ISO27001' in standard_code %}
                                                    <span class="badge badge-info p-2">{{ standard_code }}</span>
                                                {% elif 'ISO22000' in standard_code %}
                                                    <span class="badge badge-warning p-2">{{ standard_code }}</span>
                                                {% elif 'ISO13485' in standard_code %}
                                                    <span class="badge badge-secondary p-2">{{ standard_code }}</span>
                                                {% elif 'ISO50001' in standard_code %}
                                                    <span class="badge p-2" style="background-color: #9c27b0; color: white;">{{ standard_code }}</span>
                                                {% elif 'ISO20000' in standard_code %}
                                                    <span class="badge p-2" style="background-color: #ff9800; color: white;">{{ standard_code }}</span>
                                                {% elif 'ISO22301' in standard_code %}
                                                    <span class="badge p-2" style="background-color: #795548; color: white;">{{ standard_code }}</span>
                                                {% elif 'ISO37001' in standard_code %}
                                                    <span class="badge p-2" style="background-color: #607d8b; color: white;">{{ standard_code }}</span>
                                                {% elif 'HACCP' in standard_code %}
                                                    <span class="badge p-2" style="background-color: #e91e63; color: white;">{{ standard_code }}</span>
                                                {% elif 'FSSC' in standard_code %}
                                                    <span class="badge p-2" style="background-color: #00bcd4; color: white;">{{ standard_code }}</span>
                                                {% elif 'IFS' in standard_code %}
                                                    <span class="badge p-2" style="background-color: #3f51b5; color: white;">{{ standard_code }}</span>
                                                {% elif 'BRC' in standard_code or 'BRCFood' in standard_code %}
                                                    <span class="badge p-2" style="background-color: #ff5722; color: white;">{{ standard_code }}</span>
                                                {% else %}
                                                    <span class="badge badge-dark p-2">{{ standard_code }}</span>
                                                {% endif %}
                                                {% endwith %}
                                            </li>
                                            {% endfor %}
                                        </ul>
                                        {% else %}
                                        <span class="text-muted">Nema standarda</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if auditor.all_iaf_codes %}
                                        <ul class="list-unstyled mb-0">
                                            {% for iaf_code in auditor.all_iaf_codes %}
                                            <li class="mb-1">
                                                <span class="badge badge-secondary p-1" style="font-size: 90%;">{{ iaf_code }}</span>
                                            </li>
                                            {% endfor %}
                                        </ul>
                                        {% else %}
                                        <span class="text-muted">Nema IAF/EAC kodova</span>
                                        {% endif %}
                                    </td>
                                    <td class="action-buttons">
                                        <a href="{% url 'company:auditor_detail' auditor.id %}" class="btn btn-sm btn-info" title="Detalji">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                        <a href="{% url 'company:auditor_update' auditor.id %}" class="btn btn-sm btn-primary" title="Izmeni">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                        <a href="{% url 'company:auditor_delete' auditor.id %}" class="btn btn-sm btn-danger" title="Obriši">
                                            <i class="fas fa-trash"></i>
                                        </a>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="7" class="text-center">Nema pronađenih auditora</td>
                                </tr>
                                {% endfor %}
          </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap4.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.4.0/js/dataTables.responsive.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.4.0/js/responsive.bootstrap4.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.3.3/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.3.3/js/buttons.bootstrap4.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/2.3.3/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.3.3/js/buttons.print.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.3.3/js/buttons.colVis.min.js"></script>
<script>
$(function () {
    // Inicijalizacija DataTable
    var table = $("#auditorsTable").DataTable({
      "responsive": true, 
      "lengthChange": true, 
      "autoWidth": false,
      "language": {
        "search": "Pretraži:",
        "lengthMenu": "Prikaži _MENU_ redova po stranici",
        "info": "Prikazano _START_ do _END_ od ukupno _TOTAL_ redova",
        "infoEmpty": "Nema podataka za prikaz",
        "infoFiltered": "(filtrirano od ukupno _MAX_ redova)",
        "paginate": {
          "first": "Prva",
          "last": "Poslednja",
          "next": "Sledeća",
          "previous": "Prethodna"
        },
        "zeroRecords": "Nema pronađenih rezultata"
      },
      "buttons": ["copy", "csv", "excel", "pdf", "print", "colvis"],
      // Sakrivanje podrazumevanog polja za pretragu
      "searching": true,
      "dom": '<"row"<"col-md-6"B><"col-md-6"f>>rt<"row"<"col-md-6"l><"col-md-6"p>>'
    });
    
    // Povezivanje našeg polja za pretragu sa DataTable pretragom
    $('#tableSearch').keyup(function() {
        table.search($(this).val()).draw();
    });
    
    // Dodavanje dugmadi za export
    table.buttons().container().appendTo('#auditorsTable_wrapper .col-md-6:eq(0)');
    
    // Sakrivanje podrazumevanog polja za pretragu
    $('#auditorsTable_filter').hide();
});
</script>
{% endblock %}
